# Пример работы с файлами в C++

Рано или поздно у любого человека, пишущего на С++ (да и на другом ЯП) может возникнуть потребность в работе с файлами. Либо писать информацию в них, либо выводить содержимое файла. В данной статье будет рассмотрена работа с библиотекой `fstream`.

Для работы с файлами используются специальные типы данных, называемые *потоками*. Поток `ifstream` служит для работы с файлами в режиме чтения, а `ofstream` в режиме записи. Для работы с файлами в режиме как записи, так и чтения служит поток `fstream`.

## Вывод содержимого текстового файла

Для вывода текстового файла используется следующий алгоритм:

* Объявляется переменная строкового типа (`string`), в которой будет "храниться" содержимое текстового файла.
* Открыть файл.
* Считать информацию из файла.
* **Обязательно** закрыть его.

Для начала создадим какой-либо текстовый файл:

```bash
cat > file.txt << "EOF"
Пример текстового файла для открытия в программе file_open.cpp

Для работами с файлами используется библиотека fstream, а для
потокового ввода-вывода информации - iostream. Все они подключаются
в начале исходного кода с помощью #include <LIB>.

Используем функцию print_message(), в которой проверяем файл на
наличие (а если быть точным, проверяем файл на возможность
открытия). Если всё впорядке - то через цикл выводим построчно
содержимое файла. Если нет - то выводим сообщение ошибки. Для
его выделения красным цветом используется escape-последовательность
\e[1;31m ... \e[0m.
EOF
```

На самом деле, содержимое файла может быть любым. Запишите нужное между строками:
```bash
cat > file.txt << "EOF"

 ...

EOF
```

Всё содержимое:
```c++
/*
 * Проект, демонстрирующий работу с библиотекой fstream
 */
#include <iostream>
#include <fstream>
using namespace std;

// Функция для открытия файла со справкой
void print_text() {
    string line; /*
		  * Объявление переменной line строкового типа,
		  * в которой будет находиться содержимое файла
		  */

    ifstream file("file.txt");
    
    // Проверка на наличие файла
    if (file.is_open()) {
        while (getline(file, line)) {
            cout << line << endl; // Вывод информации из текста
        }
    } else {
        cout << "\a\e[1;31mОШИБКА: файл \e[0m\e[35mhello.txt\e[0m\e[1;31m не существует!\e[0m\n";
        exit(1); // Завершение программы с кодом ошибки 1
    }
    file.close(); // Закрытие файла
}

int main() {
    print_text();
    return 0;
}
```

Для того, чтобы прочитать содержимое из файла, нужно объявить несколько переменных. Первая, типа `string`, будет выводиться на экран с помощью `cout` из библиотеки `iostream`, а вторая, типа `ifstream`, будет использоваться для прочтения файла.

```c++
string line;
ifstream file("file.txt");
```

После чего проверяем файл на то, что его удалось открыть:

```c++
if (file.is_open()) {
	...
} else {
	cout << "ERROR\n";
	exit(1);
}
```

Здесь мы используем оператор `is_open`. Если он возвратил `true`, то выполняет действия, отмеченные многоточием (`...`). Если нет (`false`), то выводит сообщение об ошибке и завершает свою работу с кодом ошибки `1` (`exit(1);`).

Теперь то, что подставляется вместо многоточия. Это вывод содержимого файла:

```c++
while (getline(file, line)) {
	cout << line << endl;
}
```

Здесь содержимое строки из `file` присваивается переменной `line`. И после выводится на экран с помощью `cout`. После чего операция повторяется до тих пор, пока все строки в файле не закончатся.

После выполнения всех этих операций файл нужно **обязательно** закрыть:

```c++
file.close();
```

Всё это содержится в функции `print_text()`.

Собственно, всё понятно по комментариям. Вы могли заметить ненужное объявление функции `print_text()`. Да, можно всё сделать в `main()`, но в будущем программа станет "умнее". В неё добавится ещё несколько функций, а `main()` заметно расширится.

Скомпилируйте программу с помощью `g++`, например так:

```bash
g++ CODE.cpp -o CODE
```

Для запуска выполните:

```bash
./CODE
```

`CODE` замените на нужный файл.

![Пример работы](pic/fstream_prog_1.png)

## Запись информации в файл

Теперь поинтереснее. Запись в файл. Объявите функцию `write_text()`:

```c++
void write_text() {
	int i, num;
	double a;
	ofstream file("write.txt");
```

Теперь задача. Записать в файл несколько вещественных чисел. Переменная `num` используется для хранения количества чисел, `a` - само число, а `i` - счётчик цикла.

```c++
	cout << "Введите количество чисел: ";
	cin >> n;
	
	for (i = 0; i < n; i++) {
		cout << "Введите число: ";
		cin >> a;
		
		file << a << "\t"; // Запись числа в файл
	}
	
	file.close(); // Закрытие файла
}
```

Полный исходный код полученной функции:
```c++
void write_text() {
	int i, num;
	double a;
	
	ofstream file("write.txt");
	cout << "Введите количество чисел: ";
	cin >> n;
	
	for(i = 0; i < n; i++) {
		cout << "Введите число: ";
		cin >> a;
		
		file << a << "\t"; // Запись числа в файл
	}
	
	file.close(); // Закрытие файла
}
```

Теперь нужно вставить это в исходный код. До или после функции `print_text()` - дело ваше. Теперь расширим функцию `main()` для того, чтобы можно было выбирать нужное действие: вывод содержимого файла, либо запись в него.

```c++
int main() {
	int run; // Объявление переменной, содержащей номер нужного действия
	
	cout << "Введите номер действия (1 - вывод, 2 - ввод): ";
	cin >> run;
	
	switch(run) {
		case 1:
			print_text();
		case 2:
			write_text();
		default:
			cout << "\e[1;31mОШИБКА: неправильно введена опция!\e[0m"
			exit(1);
	}
	
	return 0;
}
```
