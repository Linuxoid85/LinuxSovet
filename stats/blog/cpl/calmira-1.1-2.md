# Опыт использования CalmiraLinux LX4 1.1. Часть 2 - процесс настройки.

В первой части статьи рассказал про опыт установки этой системы на ПК, сейчас же речь пойдёт о первичной настройке дистрибутива для дальнейших операций с ним. Например, настрою часовые зоны и прочее.

## Загрузка дистрибутива

Загрузка системы похожа на процесс загрузки всех других систем. Если не указан аргумент `quiet` ядра, то будут выводиться все его сообщения вперемешку с сообщениями системы инициализации SysVInit. Если аргумент `quiet` указан, то будут выведены сообщения системы инициализации, а так же какие-то предупреждающие сообщения.

Значение `LOGLEVEL` из файла `/etc/sysconfig/console` по умолчанию не установлено, а это значит, что в консоль будут перенаправляться сообщения dmesg. Это может оказать некоторые проблемы в процессе использования дистрибутива, поэтому после входа в систему настоятельно рекомендуется добавить строку:

```bash
LOGLEVEL=1
```

в файл `/etc/sysconfig/console`, дабы избежать вывода сообщений dmesg в консоль. В релизе LX4 1.2 этот параметр будет использован по умолчанию.

### Вход в систему

После полной загрузки системы вас будет ожидать `login`, запрашивающий аутентификационные данные определённого пользователя. Сейчас доступен только `root`. Логин: `root`, пароль: `root`.

> Настоятельно не рекомендуется использовать учётную запись `root` в качестве основной. В случае неправильного действия пользователя или какого-либо ПО это может оказать губительное действие на систему. После первичной настройки системы нужно обязательно создать обычного непривилегированного пользователя.

После логина вас будет ожидать оболочка `bash`. Кроме неё никаких не установлено, а `/bin/sh` является ссылкой на `/bin/bash`.

## Настройка системы

### Настройка часового пояса

Для настройки времени.

Введите команду:

```bash
tzselect
```

Следуйте указаниям программы для выбора вашего часового пояса. В конце она выдаст нужные результаты. Например, у меня это `Europe/Moscow`. Запомните вывод программы и выполните следующую команду:

```bash
ln -sfv /usr/share/zoneinfo/$ZONE /etc/localtime
```

Замените `$ZONE` на путь к вашему часовому поясу (из вывода `tzselect`.

### Настройка сети

> Для использования сети, возможно, придётся пересобрать ядро Linux.

Для работы с сетью в CalmiraLinux установлен следующий софт:

- `inetutils`;
- `dhcpcd`;
- `wpa_supplicant`.

Поговорим про `wpa_supplicant`:

- Это кросс-платформенная свободная реализация стандарта IEEE 802.11 для GNU/Linux, *BSD, Windows, MacOS X и прочих.
- Полная поддержка WPA2, WPA и некоторых других протоколов безопасности беспроводной LAN-сети.
- Приложение пользовательского пространства, выполняющее функции саппликанта и SME оператора, исполняющего MLME инструкции.

Поддерживает:

- WPA и полностью IEEE 802.11i/RSN/WPA2.
- WPA-PSK и WPA2-PSK (pre-shared key) ("WPA-Personal").
- WPA вместе с EAP (т.е., сервером аутентификации RADIUS) ("WPA-Enterprise") управление ключами CCMP, TKIP, WEP (104/128 и 40/64 бит).
- Кэширование RSN, PMKSA: предварительную аутентификацию.

Процесс установки связи с точкой доступа:

- Сетевой интерфейс *уже* исправно функционирует, нужные драйвера установлены в ядре, после чего `wpa_supplicant` должен запуститься.
- `wpa_supplicant` сканирует доступные Basic Service Set (BSS).
- Производит выбор BSS в соответствии с настройками.
- Запрашивает драйвер ядра установить соединение с выбранной BSS.
- И прочие действия.

**Процесс конфигурирования ядра**

В стоковом ядре уже включено всё нужное, но если вы решили собрать своё ядро, то убедитесь, что следующее включено:

```
[*] Networking support  --->                              [CONFIG_NET]
  [*] Wireless  --->                                      [CONFIG_WIRELESS]
    <*/M> cfg80211 - wireless configuration API           [CONFIG_CFG80211]
    [*]     cfg80211 wireless extensions compatibility    [CONFIG_CFG80211_WEXT]
    <*/M> Generic IEEE 802.11 Networking Stack (mac80211) [CONFIG_MAC80211]
Device Drivers  --->
  [*] Network device support  --->                        [CONFIG_NETDEVICES]
    [*] Wireless LAN  --->                                [CONFIG_WLAN]
```

**Процесс конфигурации `wpa_supplicant`**

Конфигурационные файлы: `/etc/sysconfig/wpa_supplicant-*.conf`. Где `*` - название нужного сетевого интерфейса. Например, в моём случае это будет `wlp2s0`, в других случаях будет, например, `wlan0` и прочее.

> **ВНИМАНИЕ!**

> Замените в файлах и конфигах `wlp2s0` на имя вашего сетевого интерфейса. Далее будет использоваться `wlp2s0`, вы ставите нужное.

Чтобы подключиться к точке доступа, которая использует пароль, вам необходимо предварительно поместить общий ключ в `/etc/sysconfig/wpa_supplicant-wlp2s0.conf`. `SSID` - строка, которую точка доступа или маршрутизатор передаёт для идентификации себя.

```bash
wpa_passphrase SSID SECRET_PASSWORD > /etc/sysconfig/wpa_supplicant-wlp2s0.conf
```

`/etc/sysconfig/wpa_supplicant-wlp2s0.conf` может содержать сведения о нескольких точках доступа. Когда `wpa_supplicant` будет запущен, он будет сканировать SSID, к которым можно подключиться, и выберет нужный пароль для подключения.

В случае, если вы используете точку доступа, не защищённую паролем, поместите следующую запись в `/etc/sysconfig/wpa_supplicant-wlp2s0.conf`. Замените `SOME_SSID` на имя точки доступа.

```
network={
  ssid="SOME_SSID"
  key_mgmt=NONE
}
```

Далее вам требуется создать файл `/etc/sysconfig/ifconfig-wlp2s0` (замените `wlp2s0` на имя нужного интерфейса. По аналогии с `wpa_supplicant`).

```bash
cat > /etc/sysconfig/ifconfig.wifi0 << "EOF"
ONBOOT="yes"
IFACE="wlp2s0"
SERVICE="wpa"

# Additional arguments to wpa_supplicant
WPA_ARGS=""

WPA_SERVICE="dhcpcd"
DHCP_START="-b -q <нужные ключи запуска>"
DHCP_STOP="-k <нужные ключи остановки>"
EOF
```

В том случае, если вы используете статические адреса в локальной сети, создайте файл `/etc/sysconfig/ifconfig-wlp2s0` со следующем содержимым:

```bash
cat > /etc/sysconfig/ifconfig.wifi0 << "EOF"
ONBOOT="yes"
IFACE="wlp2s0"
SERVICE="wpa"

# Additional arguments to wpa_supplicant
WPA_ARGS=""

WPA_SERVICE="ipv4-static"
IP="192.168.1.1"
GATEWAY="192.168.1.2"
PREFIX="24"
BROADCAST="192.168.1.255"
EOF
```

Подключиться к сети можно с помощью следующей команды:

```bash
ifup wlp2s0
```

Замените `wlp2s0` на имя вашего сетевого интерфейса. Напоминаю, что в файлах `/etc/sysconfig/wpa_supplicant-*.conf` и `/etc/sysconfig/ifconfig-*` должно быть то же название. Это может быть `wifi0` и другие.

Далее подключение будет автоматическим во время загрузки системы.

> **Смотрите также:**

> Для более удобной работы с Wi-Fi можете установить порт `network/connecting/WT` (Wireless Tools-29). Он включает в себя программы `ifrename`, `iwconfig`, `iwevent`, `iwgetid`, `iwlist` и другие. `iwlist`, например, предназначена для получения подробной информации о беспроводной точке доступа.

### Настройка количества TTY

> **ВНИМАНИЕ!**

> В данном пункте редактируется файл `/etc/inittab`. При неправильных параметрах в котором система может неправильно загружаться и функционировать. Редактируйте этот файл в случае действительной необходимости.

Система инициализации SystemVInit читает параметры из файла `/etc/inittab`. Так же там описан запуск программ `sulogin` (программа для логина пользователей), `agetty` (алтернатива `getty` - программа, управляющая доступам к TTY).

По умолчанию в этом файле содержатся базовые настройки, которые будут оптимальными для большинства пользователей. Для того, чтобы отредактировать его, выполните:

```bash
vim /etc/inittab
```

Редактирование этого файла может быть полезным, если требуется изменить число TTY, например. По умолчанию их 6:

```bash
1:2345:respawn:/sbin/agetty --noclear tty1 9600
2:2345:respawn:/sbin/agetty tty2 9600
3:2345:respawn:/sbin/agetty tty3 9600
4:2345:respawn:/sbin/agetty tty4 9600
5:2345:respawn:/sbin/agetty tty5 9600
6:2345:respawn:/sbin/agetty tty6 9600
```

Для добавления новых TTY добавьте строку формата:

```bash
$NUMBER:2345:respawn:/sbin/agetty tty$NUMBER 9600
```

Замените `$NUMBER` на номер TTY.

Переключаться между TTY можно сочетанием клавиш Ctrl+Alt+F`n`, где `n` - номер функциональной клавиши, равный номеру TTY, или Alt+Left / Alt+Right.
