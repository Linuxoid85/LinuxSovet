# Релиз CalmiraLinux LX4 1.1

Мало кто знает, но я так же занят разработкой независимого дистрибутива CalmiraLinux. Это source-based дистрибутив, следующий идеологии KISS.

Несмотря на ограниченные сроки выхода и отсутствие времени у меня, релизнул версию LX4 1.1 тогда, когда обещал. Несмотря на то, что некоторые изменения так и не смог реализовать, они будут реализованы в следующих релизах.

## Особенности

Из особенностей можно отметить:

- Использование системы портов вместо классической парадигмы управления программным обеспечение. На данный момент не предоставляется ни одного готового бинарного пакета. Всё, что нужно установить пользователю, собирается из исходного кода.
- Предоставление "классической" системы инициализации SysVInit.
- Модульная структура системы. Дистрибутив построен на основе [CPL](https://github.com/CalmiraLinux/CPL) - монолитного, автомарно обновляемого образа с набором минимально возможного ПО для работы системы. Он не включает в себя ядро Linux, загрузчик и систему инициализации.
- Как вы могли заметить, в названии системы так же присутствует пометка `LX4`. Это значит, что CPL собирался с использованием инструкций [LX4U](https://lx4u.ru). Использованная версия: Dev (на момент выхода релиза CalmiraLinux - это будущая версия 2.0). Планировалось использование версии 1.3, но по некоторым причинам была выбрана именно dev.
- Распространение образов в виде `squashfs`-снимков. Пользователь сам должен распаковать их, подготовить разделы и скопировать туда содержимое снимков, а далее приступить к настройке системы.

## Позиционирование

Дистрибутив ориентирован на опытного пользователя или гика, а так же владельцев слабого железа. В CalmiraLinux представлена большая свобода действий для пользователей, большое число компонентов ОС поддаётся настройке.

## Список изменений

1. Переход на более безопасную и надёжную классическую (CDS, classical directory structure) структуру директорий системы, в которой каталоги /bin, /sbin, /usr/sbin и /lib не являются ссылками на /usr/bin и /usr/lib соотв. (в релизе LX4 1.0 был выполнен незапланированный переход на упрощённую).
2. Включение в состав системы портов - нового средства управления софтом. Сейчас предназначена только для автоматизации сборки программ.
3. Обновление большинства пакетов. В частности, ядро linux обновлено до версии 5.15.1.
4. Удаление из системы портов рабочего окружения GNOME Shell.
5. `fstab` и часовые зоны не настроены по умолчанию.
6. По умолчанию применяются настройки консоли для русскоязычного пользователя.
7. Использование термина `BCPL` (Beyond Calmira PLatform) вместо `Calmira`/`CalmiraLinux` в некоторых компонентах системы.

И другие. Смотрите [релиз](https://github.com/CalmiraLinux/CalmiraLinux/releases/tag/v1.1).

## Не реализовано

К сожалению, есть и то, что планировалось включить в этот релиз, но из-за отсутствия времени изменения перенесены в следующую LX4 2.0 версию.

- Формирование полноценного загрузочного iso-образа.
- Написание установщика системы.
- Выход `port-utils v1.0`, инструмента для работы с системой портов, и его включение в минимальную поставку дистрибутива.
- Подготовка сборочных скриптов для автоматизации создания тестовых сборок системы.

***

## Скачивание

Скачать образ системы можно [отсюда](https://github.com/CalmiraLinux/CalmiraLinux/releases/tag/v1.1). Заметьте, что это НЕ raw-образ, поэтому использовать его для записи на флешку не получится. Это образ squashfs.

## Подготовка образа

Два способа:

1. Распаковка образа.
2. Монтирование образа.

Я опишу два способа извлечения файлов.

### 1. Распаковка образа

Тут всё просто. Для извлечения данных этим способом нужен пакет `squashfs-tools` с **обязательной** поддержкой метода сжатия `xz`. Например, в Debian `squashfs-tools` собираются с поддержкой этого формата сжатия, а в большинстве rpm-дистрибутивов типа Альта, Fedora и прочих - нет. В таком случае в [Makefile](https://github.com/Othernet-Project/squashfs-tools/blob/master/squashfs-tools/Makefile) раскомментируйте строку:

```makefile
########### Building XZ support #############
#
# LZMA2 compression.
#
# XZ Utils liblzma (http://tukaani.org/xz/) is supported
#
# To build using XZ Utils liblzma - install the library and uncomment
# the XZ_SUPPORT line below.
#
#XZ_SUPPORT = 1
```

Чтобы получилось так:

```makefile
########### Building XZ support #############
#
# LZMA2 compression.
#
# XZ Utils liblzma (http://tukaani.org/xz/) is supported
#
# To build using XZ Utils liblzma - install the library and uncomment
# the XZ_SUPPORT line below.
#
XZ_SUPPORT = 1
```

После чего банальные:

```bash
make && make install
```

И можно распаковывать:

```bash
sudo unsquashfs  calmira-lx4-1.1-cds.sfs 
```

В итоге появится директория `squashfs-root` общим содержимым около 1.1 Гб.

### 2. Монтирование образа

Для начала создадим точку монтирования. Для наглядности это будет директория с именем `squashfs-root`. Впрочем, название некритично.

```bash
mkdir ./squashfs-root
```

И монтирую образ:

```bash
sudo mount calmira-lx4-1.1-cds.sfs squashfs-root -v
```

После чего можно производить дальнейшие действия.

## Копирование файлов

> Здесь инструкции для установки дистрибутива на реальный ПК. Если вы желаете установить дистрибутив в виртуалку, то посетите [эту](https://calmiralinux.github.io/handbook/site/installation/install-qemu/) страницу для получения дополнительных сведений.

Для начала подготовьте необходимые разделы в соответствии с таблицой ниже.

| Раздел | Размер | Описание | Приоритет |
|--------|--------|----------|-----------|
| `/`    | Более 1.3 Гб | Корневой раздел, куда устанавливается система | Необходимый |
| `/swap` | Половина объёма ОЗУ | Раздел подкачки (о работе оперативной памяти и подкачки читайте [здесь](https://linuxoid85.github.io/LinuxSovet/stats/RAM/ram.html)) | Опциональный |
| `/home` | На усмотрение пользователя; оставшееся незанятое пространство на ЖД | Содержит пользовательские данные. Можно и не выносить в отдельный раздел | Необязательный |

Можете создать и другие разделы.

> Требуемые разделы требуется указать в файле `/etc/fstab` установленной системы CalmiraLinux. Про это читайте [здесь](https://calmiralinux.github.io/handbook/site/installation/setting-up/#fstab).

